<!DOCTYPE html>
<html lang="it" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Catalogo Associazioni</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/css/bootstrap.min.css" rel="stylesheet" />
    <link rel="stylesheet" th:href="@{/css/tema.css}" />
    <link rel="stylesheet" th:href="@{/css/navbarStyle.css}" />
    <link rel="stylesheet" th:href="@{/css/homeStyle.css}" /> <!-- Contiene gli stili per .association-card -->
    <link rel="stylesheet" th:href="@{/css/catalogoStyle.css}" /> <!-- NUOVO LINK AL CSS SPECIFICO DEL CATALOGO -->
</head>
<body>
    <div th:replace="~{fragments/navbar :: navbar}"></div>

    <div class="container">
        <h1>Catalogo Associazioni</h1>

        <!-- Form di Ricerca -->
        <div class="search-form">
            <form th:action="@{/associazioni/catalogo}" method="get" style="display: flex; flex-wrap: wrap; gap: 15px; width: 100%; justify-content: center;">
                <label for="searchNome">Nome Associazione:</label>
                <input type="text" id="searchNome" name="searchNome" th:value="${searchNome}" placeholder="Cerca per nome..." class="form-control">

                <label for="searchCittaNome">Nome Città:</label>
                <input type="text" id="searchCittaNome" name="searchCittaNome" th:value="${searchCittaNome}" placeholder="Cerca per città..." class="form-control">
				
				<label for="sport">Sport:</label>
				<input type="text" id="sport" name="sport" th:value="${sport}" placeholder="Cerca per sport..." class="form-control">

                <input type="hidden" name="size" th:value="${pageSize}">
                <input type="hidden" name="sort" th:value="${currentSortParam}" th:if="${currentSortParam != null and currentSortParam != ''}">

                <button type="submit" class="btn btn-primary">Cerca</button>
                <a th:href="@{/associazioni/catalogo(size=${pageSize}, sort=${currentSortParam})}" th:if="${searchNome != null and searchNome != '' or searchCittaNome != null and searchCittaNome != ''}" class="btn btn-secondary">Resetta Ricerca</a>
            </form>
        </div>

        <!-- Griglia delle Associazioni -->
        <div class="associations-grid">
            <a href="#" class="association-card" th:each="associazione : ${associazionePage.content}" th:href="@{'/associazione/' + ${associazione.id}}">
                <div class="card-image">
                    <img th:if="${associazione.immagine}" th:src="@{'/image/associazione/' + ${associazione.id}}" th:alt="${associazione.nome}" />
                    <div th:unless="${associazione.immagine}">&#128247;</div>
                </div>
                <div class="card-content">
                    <h3 class="card-title" th:text="${associazione.nome}">Nome Associazione</h3>
                    <div class="card-location">
                        <span>&#128205;</span>
                        <span th:text="${associazione.citta?.nome + ', ' + associazione.indirizzo}">Città, Indirizzo</span>
                    </div>
                    <p class="card-description" th:text="${associazione.descrizione}">
                        Descrizione dell'associazione che mostra le attività principali e gli obiettivi...
                    </p>
                    <div class="card-footer">
                        <span class="founded-year" th:if="${associazione.annoFondazione}">
                            Fondato nel <span th:text="${associazione.annoFondazione}">2020</span>
                        </span>
                        <button class="btn-view">Scopri di più</button>
                    </div>
                </div>
            </a>

            <!-- Fallback quando non ci sono associazioni -->
            <div th:if="${associazionePage.isEmpty()}" class="col-12 text-center">
                <div class="alert alert-info">
                    <h4>Nessuna associazione trovata.</h4>
                    <p>Prova a modificare i criteri di ricerca o a resettare la ricerca.</p>
                </div>
            </div>
        </div>

        <!-- Controlli di Paginazione -->
        <div class="pagination" th:if="${associazionePage.totalPages > 0}">
            <a th:href="@{/associazioni/catalogo(page=${associazionePage.number - 1}, size=${pageSize}, sort=${currentSortParam}, searchNome=${searchNome}, searchCittaNome=${searchCittaNome})}"
               th:classappend="${associazionePage.first ? 'disabled' : ''}"
               th:text="Precedente"></a>

            <th:block th:with="startPage=${T(java.lang.Math).max(0, associazionePage.number - 2)},
                               endPage=${T(java.lang.Math).min(associazionePage.totalPages - 1, associazionePage.number + 2)}">
                <span th:each="i : ${#numbers.sequence(startPage, endPage)}">
                    <a th:href="@{/associazioni/catalogo(page=${i}, size=${pageSize}, sort=${currentSortParam}, searchNome=${searchNome}, searchCittaNome=${searchCittaNome})}"
                       th:classappend="${i == associazionePage.number ? 'active' : ''}"
                       th:text="${i + 1}"></a>
                </span>
            </th:block>

            <a th:href="@{/associazioni/catalogo(page=${associazionePage.number + 1}, size=${pageSize}, sort=${currentSortParam}, searchNome=${searchNome}, searchCittaNome=${searchCittaNome})}"
               th:classappend="${associazionePage.last ? 'disabled' : ''}"
               th:text="Successivo"></a>

            <p>Pagina <strong th:text="${currentPage}">1</strong> di <strong th:text="${totalPages}">1</strong> (<strong th:text="${totalItems}">0</strong> elementi in totale)</p>
        </div>
    </div>
</body>
</html>
